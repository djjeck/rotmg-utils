<html>
  <head>
    <style type="text/css">
      body {
        --sprite-size: 64px;
        --item-image-margin: 5px;
        
        background-color: #AAAAAA;
        padding: 20px 40px;
        font-family: Helvetica, Arial, sans-serif;
      }
      
      .sprite {
        width: var(--sprite-size);
      }
      
      #content,
      #config {
        display: block;
        margin: 20px auto;
        width: auto;
        
        padding: 30px;
        background-color: #FFFFFF;
      }
      
      #content {
        user-select: none;
      }
      
      .row {
        display: block;
      }
      
      .item {
        display: inline-block;
        margin: var(--item-image-margin);
        box-shadow: 0px 0px 5px black;
        background-color: #FFFFFF;
      }
      
      .item.missing {
        background-color: #FFAAAA;
      }
      
      .item.enough {
        background-color: #AAFFAA;
      }
      
      .item.enough .itemImage {
        filter: grayscale(100%);
        opacity: .4;
      }
      
      .quantityContainer {
        display: block;
        max-width: var(--sprite-size);
        padding: 5px 0px;
        text-align: center;
        font-size: 1.2em;
        font-weight: bold;
        background-color: #FFFFFF;
      }
      
      .quantity {
        display: inline-block;
        margin: 0px 5px;
      }
      
      .quantityButton {
        display: inline-block;
        font-size: 0.7em;
        cursor: pointer;
        box-shadow: 0px 0px 1px rgba(0, 0, 0, .5);
      }
      
      .quantityButton:hover {
        box-shadow: 0px 0px 2px black;
      }
      
      .quantityButton.disabled {
        opacity: 0.3;
      }
      
      #config label {
        display: block;
        margin: 4px;
      }
      
      #config .label {
        display: inline-block;
        width: 200px;
      }
      
      #config input {
        font-weight: bold;
        width: 60px;
        padding: 3px 2px;
        text-align: right;
      }
    </style>
    <script type="text/javascript">
      const Tier = {
        T7: 7,
        T8: 8,
        T9: 9,
      };
      
      const ItemType = {
        ARMOR: 1,
        WEAPON: 2,
      };
      
      const ArmorType = {
        LEATHER: 1,
        ROBE: 2,
        HEAVY: 3,
      };
      
      const WeaponType = {
        DAGGER: 1,
        BOW: 2,
        STAFF: 3,
        WAND: 4,
        SWORD: 5,
        KATANA: 6,
      };
      
      class Keys {
        makeItemKey(tier, type, itemClass) {
          let tierKey;
          switch (tier) {
            case Tier.T7: tierKey = 't7'; break;
            case Tier.T8: tierKey = 't8'; break;
            case Tier.T9: tierKey = 't9'; break;
            default: throw `Invalid tier: ${tier}`;
          }
          let typeKey;
          let classKey;
          switch (type) {
            case ItemType.ARMOR:
              typeKey = 'armors';
              switch (itemClass) {
                case ArmorType.LEATHER: classKey = 'leather'; break;
                case ArmorType.ROBE: classKey = 'robe'; break;
                case ArmorType.HEAVY: classKey = 'heavy'; break;
                default: throw `Invalid armor class: ${itemClass}`;
              }
              break;
            case ItemType.WEAPON:
              typeKey = 'weapons';
              switch (itemClass) {
                case WeaponType.DAGGER: classKey = 'dagger'; break;
                case WeaponType.BOW: classKey = 'bow'; break;
                case WeaponType.STAFF: classKey = 'staff'; break;
                case WeaponType.WAND: classKey = 'wand'; break;
                case WeaponType.SWORD: classKey = 'sword'; break;
                case WeaponType.KATANA: classKey = 'katana'; break;
                default: throw `Invalid armor class: ${itemClass}`;
              }
              break;
            default: throw `Invalid type: ${type}`;
          }
          return `quantity-${tierKey}-${typeKey}-${classKey}`;
        }
        
        makeConfigKeyEnough(type) {
          let typeKey;
          switch (type) {
            case ItemType.ARMOR: typeKey = 'armors'; break;
            case ItemType.WEAPON: typeKey = 'weapons'; break;
            default: throw `Invalid type: ${type}`;
          }
          return `enough-${typeKey}`;
        }
      }
      
      class Storage {
        constructor() {
          this.cache = {};
        }
        
        read(key, defaultValue = 0) {
          if (key in this.cache) {
            console.log(`reading ${key} -> ${this.cache[key]} (cached)`);
            return this.cache[key];
          }
          const value = localStorage.getItem(key);
          if (value === null) {
            console.log(`setting default for ${key} <- ${defaultValue}`);
            this.write(key, defaultValue);
            return defaultValue;
          }
          this.cache[key] = value;
          console.log(`reading ${key} -> ${value}`);
          return value;          
        }
        
        write(key, value) {
          console.log(`writing ${key} <- ${value}`);
          this.cache[key] = value;
          localStorage.setItem(key, value);
        }
      }
      
      class Images {
        constructor() {
           /**
            * Armors from https://www.realmeye.com/wiki/armor
            * Weapons from https://www.realmeye.com/wiki/weapons
            */
           this.items = {};
           this.items[Tier.T7] = {};
           this.items[Tier.T7][ItemType.ARMOR] = {};
           this.items[Tier.T7][ItemType.ARMOR][ArmorType.LEATHER] = 'https://static.drips.pw/rotmg/wiki/Armor/Leather%20Armor/T6%20Wyvern%20Skin%20Armor.png';
           this.items[Tier.T7][ItemType.ARMOR][ArmorType.ROBE] = 'https://static.drips.pw/rotmg/wiki/Armor/Robes/T6%20Robe%20of%20the%20Invoker.png';
           this.items[Tier.T7][ItemType.ARMOR][ArmorType.HEAVY] = 'https://static.drips.pw/rotmg/wiki/Armor/Heavy%20Armor/T6%20Mithril%20Chainmail.png';
           this.items[Tier.T7][ItemType.WEAPON] = {};
           this.items[Tier.T7][ItemType.WEAPON][WeaponType.DAGGER] = 'https://static.drips.pw/rotmg/wiki/Weapons/Daggers/T7%20Mithril%20Dagger.png';
           this.items[Tier.T7][ItemType.WEAPON][WeaponType.BOW] = 'https://static.drips.pw/rotmg/wiki/Weapons/Bows/T7%20Heavy%20Crossbow.png';
           this.items[Tier.T7][ItemType.WEAPON][WeaponType.STAFF] = 'https://static.drips.pw/rotmg/wiki/Weapons/Staves/T7%20Staff%20of%20Destruction.png';
           this.items[Tier.T7][ItemType.WEAPON][WeaponType.WAND] = 'https://static.drips.pw/rotmg/wiki/Weapons/Wands/T7%20Wand%20of%20Arcane%20Flame.png';
           this.items[Tier.T7][ItemType.WEAPON][WeaponType.SWORD] = 'https://static.drips.pw/rotmg/wiki/Weapons/Swords/T7%20Golden%20Sword.png';
           this.items[Tier.T7][ItemType.WEAPON][WeaponType.KATANA] = 'https://www.realmeye.com/s/a/img/wiki/Buster%20Katana.png';
           this.items[Tier.T8] = {};
           this.items[Tier.T8][ItemType.ARMOR] = {};
           this.items[Tier.T8][ItemType.ARMOR][ArmorType.LEATHER] = 'https://static.drips.pw/rotmg/wiki/Armor/Leather%20Armor/T7%20Studded%20Leather%20Armor.png';
           this.items[Tier.T8][ItemType.ARMOR][ArmorType.ROBE] = 'https://static.drips.pw/rotmg/wiki/Armor/Robes/T7%20Robe%20of%20the%20Illusionist.png';
           this.items[Tier.T8][ItemType.ARMOR][ArmorType.HEAVY] = 'https://static.drips.pw/rotmg/wiki/Armor/Heavy%20Armor/T7%20Mithril%20Armor.png';
           this.items[Tier.T8][ItemType.WEAPON] = {};
           this.items[Tier.T8][ItemType.WEAPON][WeaponType.DAGGER] = 'https://static.drips.pw/rotmg/wiki/Weapons/Daggers/T8%20Fire%20Dagger.png';
           this.items[Tier.T8][ItemType.WEAPON][WeaponType.BOW] = 'https://static.drips.pw/rotmg/wiki/Weapons/Bows/T8%20Golden%20Bow.png';
           this.items[Tier.T8][ItemType.WEAPON][WeaponType.STAFF] = 'https://static.drips.pw/rotmg/wiki/Weapons/Staves/T8%20Staff%20of%20Horror.png';
           this.items[Tier.T8][ItemType.WEAPON][WeaponType.WAND] = 'https://static.drips.pw/rotmg/wiki/Weapons/Wands/T8%20Wand%20of%20Death.png';
           this.items[Tier.T8][ItemType.WEAPON][WeaponType.SWORD] = 'https://static.drips.pw/rotmg/wiki/Weapons/Swords/T8%20Ravenheart%20Sword.png';
           this.items[Tier.T8][ItemType.WEAPON][WeaponType.KATANA] = 'https://www.realmeye.com/s/a/img/wiki/Demon%20Edge.png';
           this.items[Tier.T9] = {};
           this.items[Tier.T9][ItemType.ARMOR] = {};
           this.items[Tier.T9][ItemType.ARMOR][ArmorType.LEATHER] = 'https://static.drips.pw/rotmg/wiki/Armor/Leather%20Armor/T8%20Drake%20Hide%20Armor.png';
           this.items[Tier.T9][ItemType.ARMOR][ArmorType.ROBE] = 'https://static.drips.pw/rotmg/wiki/Armor/Robes/T8%20Robe%20of%20the%20Master.png';
           this.items[Tier.T9][ItemType.ARMOR][ArmorType.HEAVY] = 'https://static.drips.pw/rotmg/wiki/Armor/Heavy%20Armor/T8%20Dragonscale%20Armor.png';
           this.items[Tier.T9][ItemType.WEAPON] = {};
           this.items[Tier.T9][ItemType.WEAPON][WeaponType.DAGGER] = 'https://static.drips.pw/rotmg/wiki/Weapons/Daggers/T9%20Ragetalon%20Dagger.png';
           this.items[Tier.T9][ItemType.WEAPON][WeaponType.BOW] = 'https://static.drips.pw/rotmg/wiki/Weapons/Bows/T9%20Verdant%20Bow.png';
           this.items[Tier.T9][ItemType.WEAPON][WeaponType.STAFF] = 'https://static.drips.pw/rotmg/wiki/Weapons/Staves/T9%20Staff%20of%20Necrotic%20Arcana.png';
           this.items[Tier.T9][ItemType.WEAPON][WeaponType.WAND] = 'https://static.drips.pw/rotmg/wiki/Weapons/Wands/T9%20Wand%20of%20Deep%20Sorcery.png';
           this.items[Tier.T9][ItemType.WEAPON][WeaponType.SWORD] = 'https://static.drips.pw/rotmg/wiki/Weapons/Swords/T9%20Dragonsoul%20Sword.png';
           this.items[Tier.T9][ItemType.WEAPON][WeaponType.KATANA] = 'https://www.realmeye.com/s/a/img/wiki/Jewel%20Eye%20Katana.png';
      
           this.rewards = {};
           this.rewards[Tier.T7] = [
              'https://static.drips.pw/rotmg/wiki/Consumable/Other/XP%20Booster%201%20hr.png',
           ];
           this.rewards[Tier.T8] = [
              'https://static.drips.pw/rotmg/wiki/Consumable/Other/Loot%20Tier%20Potion.png',
              'https://static.drips.pw/rotmg/wiki/Consumable/Other/Loot%20Drop%20Potion.png',
           ];
           this.rewards[Tier.T9] = [
              'https://static.drips.pw/rotmg/wiki/Consumable/Stat%20Potions/Potion%20of%20Vitality.png',
              'https://static.drips.pw/rotmg/wiki/Consumable/Stat%20Potions/Potion%20of%20Wisdom.png',
           ];
        }
        
        getItemImage(tier, type, itemClass) {
          return this.items[tier][type][itemClass];
        }
        
        getRewardImages(tier) {
          return this.rewards[tier];
        }
      }
      
      const keys = new Keys();
      const storage = new Storage();
      const images = new Images();
      
      function bodyLoad() {
        // Initialize config first, for defaults.
        initConfig();
        render();
      }
      
      function render() {
        const contentEl = document.getElementById('content');
        
        for (const tier of Object.values(Tier)) {
          const rowEl = document.createElement('div');
          rowEl.className = 'row';
          
          // Render armors.
          for (const armorType of Object.values(ArmorType)) {
            const key = keys.makeItemKey(tier, ItemType.ARMOR, armorType);
            const src = images.getItemImage(tier, ItemType.ARMOR, armorType);
            
            const itemEl = renderItem(key, ItemType.ARMOR, src);
            rowEl.appendChild(itemEl);
          }
          
          // Render weapons.
          for (const weaponType of Object.values(WeaponType)) {
            const key = keys.makeItemKey(tier, ItemType.WEAPON, weaponType);
            const src = images.getItemImage(tier, ItemType.WEAPON, weaponType);
            
            const itemEl = renderItem(key, ItemType.WEAPON, src);
            rowEl.appendChild(itemEl);
          }
          
          // Render rewards.
          for (const reward of images.getRewardImages(tier)) {
            const rewardTemplate = document.importNode(document.querySelector('#rewardTemplate').content, true);
            const imageEl = rewardTemplate.querySelector('.rewardImage');
            imageEl.src = reward;
            rowEl.appendChild(imageEl);
          }
          
          contentEl.appendChild(rowEl);
        }
      }
      
      function renderItem(key, type, src) {
        let quantity = storage.read(key);
        const id = `item-${key}`;
        
        const itemTemplate = document.importNode(document.querySelector('#itemTemplate').content, true);
        const itemEl = itemTemplate.querySelector('.item');
        const imageEl = itemTemplate.querySelector('.itemImage');
        const quantityEl = itemTemplate.querySelector('.quantity');
        const [quantityLessEl, quantityMoreEl] = itemTemplate.querySelectorAll('.quantityButton');
        
        itemEl.id = id;
        
        const updateQuantity = () => {
          quantityEl.textContent = quantity;
          quantityLessEl.classList.toggle('disabled', quantity == 0);
          decorateQuantity(itemEl, type, quantity);
        }
        
        const increaseQuantity = () => {
          quantity++;
          storage.write(key, quantity);
          updateQuantity();
        };
        
        const decreaseQuantity = () => {
          if (quantity == 0) {
            return;
          }
          quantity--;
          storage.write(key, quantity);
          updateQuantity();
        };
        
        imageEl.src = src;
        quantityLessEl.onclick = decreaseQuantity;
        quantityMoreEl.onclick = increaseQuantity;
        updateQuantity();
        
        return itemTemplate;
      }
      
      function initConfig() {
        const enoughArmor = storage.read(keys.makeConfigKeyEnough(ItemType.ARMOR), 2);
        const enoughWeapon = storage.read(keys.makeConfigKeyEnough(ItemType.WEAPON), 3);
        
        const enoughArmorInput = document.getElementById('config-enough-armors');
        const enoughWeaponInput = document.getElementById('config-enough-weapons');
        
        enoughArmorInput.value = enoughArmor;
        enoughWeaponInput.value = enoughWeapon;
        updateVaultSlotsConfig();
        
        enoughArmorInput.onclick = () => {
          storage.write(keys.makeConfigKeyEnough(ItemType.ARMOR), enoughArmorInput.value);
          updateVaultSlotsConfig();
          decorateQuantities('armors');
        };
        enoughWeaponInput.onclick = () => {
          storage.write(keys.makeConfigKeyEnough(ItemType.WEAPON), enoughWeaponInput.value);
          updateVaultSlotsConfig();
          decorateQuantities('weapons');
        };
      }
      
      function updateVaultSlotsConfig() {
        const vaultSlots = 3 * (
          storage.read(keys.makeConfigKeyEnough(ItemType.ARMOR)) * 3 +
          storage.read(keys.makeConfigKeyEnough(ItemType.WEAPON)) * 6);
        
        const vaultChestsInput = document.getElementById('config-vault-chests');
        const vaultSlotsInput = document.getElementById('config-vault-slots');
        vaultChestsInput.value = roundFloat(vaultSlots / 8);
        vaultSlotsInput.value = vaultSlots;
      }
      
      function decorateQuantities(type) {
        for (const tier of Object.values(Tier)) {
          for (const type of Object.values(ItemType)) {
            let itemClasses;
            switch (type) {
              case ItemType.ARMOR: itemClasses = Object.values(ArmorType); break;
              case ItemType.WEAPON: itemClasses = Object.values(WeaponType); break;
              default: throw `Invalid type: ${type}`;
            }
            for (const itemClass of itemClasses) {
              const key = keys.makeItemKey(tier, type, itemClass);
              const id = `item-${key}`;
              const itemEl = document.getElementById(id);
              decorateQuantity(itemEl, type, storage.read(key));
            }
          }
        }
      }
      
      function decorateQuantity(element, type, quantity) {
        element.classList.toggle('missing', quantity == 0);
        element.classList.toggle('enough', quantity >= storage.read(keys.makeConfigKeyEnough(type)));
      }
      
      function roundFloat(number) {
        return Math.floor(number * 100) / 100;
      }
    </script>
    <title>Tinkerer items</title>
  </head>
  <body onload="bodyLoad();">
    <div class="tinkerer">
      <img class="sprite" src="https://static.drips.pw/rotmg/wiki/Environment/Quest%20Rewards.png" />
    </div>
    <div id="content">
    </div>
    <div id="config">
      <label>
        <span class="label">Enough armors</span>
        <input id="config-enough-armors" type="number" min="1" max="99" />
      </label>
      <label>
        <span class="label">Enough weapons</span>
        <input id="config-enough-weapons" type="number" min="1" max="99" />
      </label>
      
      <label>
        <span class="label">Vault chests</span>
        <input id="config-vault-chests" type="number" min="1" max="80" disabled="disabled" />
      </label>
      <label>
        <span class="label">Vault slots</span>
        <input id="config-vault-slots" type="number" min="1" max="640" disabled="disabled" />
      </label>
    </div>
    
    <template id="itemTemplate">
      <div class="item">
        <img class="sprite itemImage" />
        <div class="quantityContainer">
          <!-- White Down-Pointing Triangle https://unicode-table.com/en/25BD/ -->
          <span class="quantityButton">&#x25BD;</span>
          <span class="quantity"></span>
          <!-- White Up-Pointing Triangle https://unicode-table.com/en/25B3/ -->
          <span class="quantityButton">&#x25B3;</span>
        </div>
      </div>
    </template>
    
    <template id="rewardTemplate">
      <img class="sprite rewardImage" />
    </template>

    <!-- Fork me on GitHub ribbon, from https://github.com/blog/273-github-ribbons -->
    <a href="https://github.com/djjeck/rotmg-utils"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/38ef81f8aca64bb9a64448d0d70f1308ef5341ab/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6461726b626c75655f3132313632312e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"></a>
  </body>
</html>

